<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Congre (grenier.Congre)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">grenier</a> &#x00BB; Congre</nav><header class="odoc-preamble"><h1>Module <code><span>Congre</span></code></h1><p>Creations of equality graph</p></header><nav class="odoc-toc"><ul><li><a href="#assume-properties-on-classes">Assume properties on classes</a></li><li><a href="#observe-equivalence-structure">Observe equivalence structure</a></li><li><a href="#associating-values-with-classes">Associating values with classes</a></li><li><a href="#variables">Variables</a></li><li><a href="#snapshots">Snapshots</a></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-graph"><a href="#type-graph" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a graph</span></span></code></div><div class="spec-doc"><p>The graph structure, used to keep global information about elements and implement interpretation. Only elements from the graph can be related.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-node"><a href="#type-node" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a node</span></span></code></div><div class="spec-doc"><p>Handle to an equivalence class</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-merger"><a href="#type-merger" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a merger</span></span><span> = <span><span class="label">repr</span>:<span><span class="type-var">'a</span> <a href="#type-node">node</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-node">node</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Create a new graph.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make"><a href="#val-make" class="anchor"></a><code><span><span class="keyword">val</span> make : <span><span class="optlabel">?on_merge</span>:<span><span class="type-var">'a</span> <a href="#type-merger">merger</a></span> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-graph">graph</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_on_merge"><a href="#val-set_on_merge" class="anchor"></a><code><span><span class="keyword">val</span> set_on_merge : <span><span><span class="type-var">'a</span> <a href="#type-graph">graph</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-merger">merger</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fresh"><a href="#val-fresh" class="anchor"></a><code><span><span class="keyword">val</span> fresh : <span><span><span class="type-var">'a</span> <a href="#type-graph">graph</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-node">node</a></span></span></code></div><div class="spec-doc"><p><code>fresh gr x</code> creates a new equivalence class in graph <code>gr</code> with associated value <code>x</code></p></div></div><h2 id="assume-properties-on-classes"><a href="#assume-properties-on-classes" class="anchor"></a>Assume properties on classes</h2><div class="odoc-spec"><div class="spec value anchored" id="val-assume_equal"><a href="#val-assume_equal" class="anchor"></a><code><span><span class="keyword">val</span> assume_equal : <span><span><span class="type-var">'a</span> <a href="#type-node">node</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-node">node</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>assume_equal x y</code> adds the equation <code>x = y</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-assume_application"><a href="#val-assume_application" class="anchor"></a><code><span><span class="keyword">val</span> assume_application : <span><span><span class="type-var">'a</span> <a href="#type-node">node</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-node">node</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="label">equal</span>:<span><span class="type-var">'a</span> <a href="#type-node">node</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>assume_application f x ~equal:y</code> adds the equation <code>y = f x</code></p></div></div><h2 id="observe-equivalence-structure"><a href="#observe-equivalence-structure" class="anchor"></a>Observe equivalence structure</h2><div class="odoc-spec"><div class="spec value anchored" id="val-propagate"><a href="#val-propagate" class="anchor"></a><code><span><span class="keyword">val</span> propagate : <span><span><span class="type-var">'a</span> <a href="#type-graph">graph</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>propagate graph</code> updates the congruence closure to account for all added equations.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-same"><a href="#val-same" class="anchor"></a><code><span><span class="keyword">val</span> same : <span><span><span class="type-var">'a</span> <a href="#type-node">node</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-node">node</a></span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>same x y</code> returns true iff <code>x</code> and <code>y</code> are in the same congruence. New equations are <code>propagated</code> if necessary.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-find_app"><a href="#val-find_app" class="anchor"></a><code><span><span class="keyword">val</span> find_app : <span><span><span class="type-var">'a</span> <a href="#type-node">node</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-node">node</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-node">node</a></span> option</span></span></code></div><div class="spec-doc"><p><code>find_app f x</code> returns <code>Some z</code> if any node is already equal to <code>f x</code> (added via <code>assume_application</code>), or <code>None</code> otherwise.</p></div></div><h2 id="associating-values-with-classes"><a href="#associating-values-with-classes" class="anchor"></a>Associating values with classes</h2><div class="odoc-spec"><div class="spec value anchored" id="val-get_tag"><a href="#val-get_tag" class="anchor"></a><code><span><span class="keyword">val</span> get_tag : <span><span><span class="type-var">'a</span> <a href="#type-node">node</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>get_tag n</code> returns the <code>tag</code> associated with the class of <code>n</code> (not the node).</p><p>Warning: this function doesn't propagate equation. Call <code>propagate</code> before if necessary.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_tag"><a href="#val-set_tag" class="anchor"></a><code><span><span class="keyword">val</span> set_tag : <span><span><span class="type-var">'a</span> <a href="#type-node">node</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>set_tag n x</code> changes the <code>tag</code> associated with the class of <code>n</code> (not the node).</p><p>Warning: this function doesn't propagate equation. Call <code>propagate</code> before if necessary.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_root_tag"><a href="#val-set_root_tag" class="anchor"></a><code><span><span class="keyword">val</span> set_root_tag : <span><span><span class="type-var">'a</span> <a href="#type-node">node</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>set_root_tag n x</code> changes the <code>tag</code> associated with the node <code>n</code>. This function should be called before any equation is added about <code>n</code>. The root tag is not backed up (it won't be restored by <code>restore</code>).</p><p>The purpose of this function is to change the tag of a <code>fresh</code> node, immediately after its creation. This is useful if the tag needs to reference the node (to create a recursion between a node and its tag).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_id"><a href="#val-get_id" class="anchor"></a><code><span><span class="keyword">val</span> get_id : <span><span><span class="type-var">'a</span> <a href="#type-node">node</a></span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>get_id node</code> returns an integer identifying <code>node</code> (unique for the graph). This function is constant: the integer identify the node and not the equivalence class.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-compare"><a href="#val-compare" class="anchor"></a><code><span><span class="keyword">val</span> compare : <span><span><span class="type-var">'a</span> <a href="#type-node">node</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-node">node</a></span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>compare a b</code> compares two nodes by their id.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_repr"><a href="#val-get_repr" class="anchor"></a><code><span><span class="keyword">val</span> get_repr : <span><span><span class="type-var">'a</span> <a href="#type-node">node</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-node">node</a></span></span></code></div><div class="spec-doc"><p><code>get_repr node</code> returns the node that is the representative of the equivalence class of <code>node</code> in the current state. The representative can change when new equations are propagated.</p><p>Warning: this function doesn't propagate equations. Call <code>propagate</code> before if necessary.</p></div></div><h2 id="variables"><a href="#variables" class="anchor"></a>Variables</h2><div class="odoc-spec"><div class="spec type anchored" id="type-var"><a href="#type-var" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a var</span></span></code></div><div class="spec-doc"><p>An <code>'a var</code> is like a <code>'a ref</code>, but its contents is backed up and restored when using <code>snapshot</code> and <code>restore</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-var"><a href="#val-var" class="anchor"></a><code><span><span class="keyword">val</span> var : <span><span><span class="type-var">_</span> <a href="#type-graph">graph</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-var">var</a></span></span></code></div><div class="spec-doc"><p><code>var graph x</code> creates a new variable with initial value <code>x</code>, which contents is backed up and restored when snapshotting and restoring <code>graph</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_var"><a href="#val-get_var" class="anchor"></a><code><span><span class="keyword">val</span> get_var : <span><span><span class="type-var">'a</span> <a href="#type-var">var</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>get_var v</code> retrieves the current value of the variable, like <code>!</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_var"><a href="#val-set_var" class="anchor"></a><code><span><span class="keyword">val</span> set_var : <span><span><span class="type-var">'a</span> <a href="#type-var">var</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>set_var v x</code> changes the current value of the variable, like <code>:=</code></p></div></div><h2 id="snapshots"><a href="#snapshots" class="anchor"></a>Snapshots</h2><div class="odoc-spec"><div class="spec type anchored" id="type-snapshot"><a href="#type-snapshot" class="anchor"></a><code><span><span class="keyword">type</span> snapshot</span></code></div><div class="spec-doc"><p>A snapshot (efficiently) stores the state of the congruence closure (and its associated variables) at a specific point in time.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-snapshot"><a href="#val-snapshot" class="anchor"></a><code><span><span class="keyword">val</span> snapshot : <span><span><span class="type-var">'a</span> <a href="#type-graph">graph</a></span> <span class="arrow">&#45;&gt;</span></span> <a href="#type-snapshot">snapshot</a></span></code></div><div class="spec-doc"><p><code>snapshot graph</code> takes a snapshot of the current state.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-restore"><a href="#val-restore" class="anchor"></a><code><span><span class="keyword">val</span> restore : <span><a href="#type-snapshot">snapshot</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>restore sn</code> restores the congruence closure to the exact same state it had when <code>sn = snapshot graph</code> was called.</p><p>Precondition: snapshot must be valid, see <code>is_valid</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_valid"><a href="#val-is_valid" class="anchor"></a><code><span><span class="keyword">val</span> is_valid : <span><a href="#type-snapshot">snapshot</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>A <code>snapshot</code> becomes invalid when an earlier snapshot is restored. This only applies to the descendants: a snapshot that is restored remains valid, and can be restored multiple times. For instance, the following holds: let s1 = snapshot graph in let s2 = snapshot graph in restore s1; assert (is_valid s1); assert (not (is_valid s2))</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-invalid_snapshot"><a href="#val-invalid_snapshot" class="anchor"></a><code><span><span class="keyword">val</span> invalid_snapshot : <a href="#type-snapshot">snapshot</a></span></code></div><div class="spec-doc"><p><code>invalid_snapshot</code> for which <code>is_valid</code> is always <code>false</code>. It cannot be restored. Its purpose is to be used as a placeholder in places where a snapshot is expected but doesn't have to be valid.</p></div></div></div></body></html>
